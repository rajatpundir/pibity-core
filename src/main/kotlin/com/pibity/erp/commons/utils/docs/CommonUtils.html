<h1>Imports</h1>
<ul>
    <li>
        import com.google.gson.*
    </li>
    <li>
        import com.pibity.erp.commons.exceptions.CustomJsonException
    </li>
    <li>
        import org.keycloak.adapters.springsecurity.account.SimpleKeycloakAccount
    </li>
    <li>
        import org.keycloak.adapters.springsecurity.token.KeycloakAuthenticationToken
    </li>
    <li>
        import org.keycloak.representations.AccessToken
    </li>
    <li>
        import java.io.File
    </li>
</ul>

<h1>Variables</h1>
<ul>
    <li>
        <h2>val gson: Gson</h2>
        <code>GsonBuilder().excludeFieldsWithoutExposeAnnotation().create()</code>
        <h3>Comments</h3>
        <ul>
            <li>
                GsonBuilder() is used to create a Gson() object with specific configuration.
            </li>
            <li>
                Custom Adapters can be written for any class which can be given to GsonBuilder() to override the Json
                Serialization step.
            </li>
            <li>
                Gson() object is used to serialize Java objects into Java objects representing JSON data. These JSON
                objects can be used to get their equivalent string representations that we can send to client app.
                <h4>Examples of commonly used JSON classes from Gson package(com.google.gson):</h4>
                <ul>
                    <li>
                        JsonElement
                        <ul>
                            <li>It is a class that represents any Json element. It could be a JsonObject, JsonArray,
                                JsonPrimitive, etc.
                            </li>
                        </ul>
                    </li>
                    <li>
                        JsonObject
                        <ul>
                            <li>It is a class that represents a Json Object.</li>
                        </ul>
                    </li>
                    <li>
                        JsonArray
                        <ul>
                            <li>It is a class that represents a Json Array.</li>
                        </ul>
                    </li>

                </ul>
            </li>
            <li>
                In above code, Gson() object is configured to serialize only those fields of a Java object that have
                @Expose annotation on them.
            </li>
        </ul>
    </li>
</ul>

<h1>Functions</h1>
<ul>
    <li>
        <h2>getExpectedParams</h2>
        <code>
            fun getExpectedParams(controller: String, filename: String): JsonObject =
            gson.fromJson(File("src/main/resources/requests/$controller/$filename.json").readText(),
            JsonObject::class.java)
        </code>
        <h3>Comments</h3>
        <ul>
            <li>Reads a json file in resources directory and returns a JsonObject representation</li>
        </ul>
    </li>
    <li>
        <h2>getJsonParams</h2>
        <pre>
// Parses JSON from request to generate JSON Object with whitelisted properties
// Raises exception if expected property is missing or of incorrect type
fun getJsonParams(request: String, expectedParams: JsonObject): JsonObject {
  // Parse request body to get a JsonObject
  val json: JsonObject = try {
    JsonParser.parseString(request).asJsonObject
  } catch (exception: Exception) {
    throw CustomJsonException("{'error': 'Unable to parse request body'}")
  }
  // Get whitelisted params into another JsonObject
  // Raise exception if expected parameter is missing or of incorrect type
  val jsonParams = JsonObject()
  for ((param, paramType) in expectedParams.entrySet()) {
    if (param.endsWith("?")) {
      val optionalParam: String = param.substringBefore("?")
      if (json.has(optionalParam)) {
        try {
          when (paramType.asJsonObject.get("type").asString) {
            "String" -> jsonParams.addProperty(param, json[optionalParam].asString)
            "Int" -> jsonParams.addProperty(param, json[optionalParam].asInt)
            "Long" -> jsonParams.addProperty(param, json[optionalParam].asLong)
            "Double" -> jsonParams.addProperty(param, json[optionalParam].asDouble)
            "Boolean" -> jsonParams.addProperty(param, json[optionalParam].asBoolean)
            "Object" -> jsonParams.add(param, json[optionalParam].asJsonObject)
            "Array" -> jsonParams.add(param, json[optionalParam].asJsonArray)
          }
        } catch (exception: Exception) {
          throw CustomJsonException("{'$optionalParam': 'Unexpected value for parameter'}")
        }
      }
    } else {
      if (!json.has(param))
        throw CustomJsonException("{'$param': 'Field is missing in request body'}")
      else {
        try {
          when (paramType.asJsonObject.get("type").asString) {
            "String" -> jsonParams.addProperty(param, json[param].asString)
            "Int" -> jsonParams.addProperty(param, json[param].asInt)
            "Long" -> jsonParams.addProperty(param, json[param].asLong)
            "Double" -> jsonParams.addProperty(param, json[param].asDouble)
            "Boolean" -> jsonParams.addProperty(param, json[param].asBoolean)
            "Object" -> jsonParams.add(param, json[param].asJsonObject)
            "Array" -> jsonParams.add(param, json[param].asJsonArray)
          }
        } catch (exception: Exception) {
          throw CustomJsonException("{'$param': 'Unexpected value for parameter'}")
        }
      }
    }
  }
  return jsonParams
}
        </pre>
    </li>
    <li>
        <h2>validateOrganizationClaim</h2>
    </li>
</ul>
